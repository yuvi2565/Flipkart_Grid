<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css"
    />
    <script src="./Cart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <link rel="stylesheet" href="./Cart.css" />
  </head>

  <body>
    <section id="header">
      <button class="use-token" id="cbtn" onclick="connectWallet()">
        Connect your Wallet
      </button>

      <a href="1home.html"><img src="logo.jpeg" class="logo" width="90px" /></a>

      <div>
        <ul id="navbar">
          <li><a href="1home.html">Home</a></li>
          <li><a href="2shop.html">Shop</a></li>
          <li><a href="3blog.html">Blog</a></li>
          <li>
            <a href="User.html">User</a>
          </li>
        </ul>
      </div>
    </section>
    <div class="Dresses">
      <center>
        <div><img src="New Season Dresses.avif" alt="" /></div>
      </center>
    </div>
    <br />
    <br />
    <div class="small-container">
      <h4>Favorite Picks &#9829;</h4>
      <br />
      <div class="row1">
        <div class="col4">
          <img class="shop-item-image" src="apples.jpg" alt="" />
          <p class="shop-item-title"><b>Apples </b></p>
          <div class="shop-item-details">
            <span class="shop-item-price">eth 5</span>
            <button class="btn btn-primary shop-item-button" type="button">
              ADD TO CART
            </button>
          </div>
        </div>
        <div class="col4">
          <img class="shop-item-image" src="fashionTshirt.jpeg" alt="" />
          <p class="shop-item-title"><b>Fashion T shirt</b></p>
          <div class="shop-item-details">
            <span class="shop-item-price">eth 17</span>
            <button class="btn btn-primary shop-item-button" type="button">
              ADD TO CART
            </button>
          </div>
        </div>
        <div class="col4">
          <img class="shop-item-image" src="watch1.jpeg" alt="" />
          <p class="shop-item-title"><b>Xiomi Digital Watch</b></p>
          <div class="shop-item-details">
            <span class="shop-item-price">eth 21</span>
            <button class="btn btn-primary shop-item-button" type="button">
              ADD TO CART
            </button>
          </div>
        </div>
        <div class="col4">
          <img class="shop-item-image" src="iphone14.jpeg" alt="" />
          <p class="shop-item-title"><b>iPhone 14 pro max 128 GB</b></p>
          <div class="shop-item-details">
            <span class="shop-item-price">eth 18</span>
            <button class="btn btn-primary shop-item-button" type="button">
              ADD TO CART
            </button>
          </div>
        </div>
      </div>
    </div>
    <br />
    <br />

    <div class="Jeans">
      <center>
        <div><img src="Bottom Top  Picks.jpg" alt="" /></div>
      </center>
    </div>

    <br />

    <!----------Favorite Picks---------->
    <div class="small-container">
      <h4>Favorite Picks &#9829;</h4>
      <br />
      <div class="row1">
        <div class="col4">
          <img class="shop-item-image" src="vivoT2x.jpeg" alt="" />
          <p class="shop-item-title">Vivo T2x 64 GB<b></b></p>
          <div class="shop-item-details">
            <span class="shop-item-price">eth 13</span>
            <button class="btn btn-primary shop-item-button" type="button">
              ADD TO CART
            </button>
          </div>
        </div>
        <div class="col4">
          <img class="shop-item-image" src="lotus.jpeg" alt="" />
          <p class="shop-item-title"><b>Lotus Sunscreen</b></p>
          <div class="shop-item-details">
            <span class="shop-item-price">eth 17</span>
            <button class="btn btn-primary shop-item-button" type="button">
              ADD TO CART
            </button>
          </div>
        </div>
        <div class="col4">
          <img class="shop-item-image" src="ponds.jpeg" alt="" />
          <p class="shop-item-title"><b>Pond's bright beauty facewash</b></p>
          <div class="shop-item-details">
            <span class="shop-item-price">eth 19</span>
            <button class="btn btn-primary shop-item-button" type="button">
              ADD TO CART
            </button>
          </div>
        </div>
        <div class="col4">
          <img class="shop-item-image" src="sexyTshirt.jpeg" alt="" />
          <p class="shop-item-title"><b>Men's Black Cottin T shirt</b></p>
          <div class="shop-item-details">
            <span class="shop-item-price">eth 18</span>
            <button class="btn btn-primary shop-item-button" type="button">
              ADD TO CART
            </button>
          </div>
        </div>
      </div>
    </div>
    <br />
    <br />

    <div class="CropTops">
      <center>
        <div><img src="Crop top.jpg" alt="" /></div>
      </center>
    </div>
    <br /><br />
    <div class="small-container">
      <h4>Favorite Picks &#9829;</h4>
      <br />
      <div class="row1">
        <div class="col4">
          <img class="shop-item-image" src="Boning Cami Top.jpg" alt="" />
          <p class="shop-item-title"><b>Boning Cami Top</b></p>
          <div class="shop-item-details">
            <p class="shop-item-price">eth 130</p>
            <button class="btn btn-primary shop-item-button" type="button">
              ADD TO CART
            </button>
          </div>
        </div>
        <div class="col4">
          <img class="shop-item-image" src="redminote12_5g.jpeg" alt="" />
          <p class="shop-item-title"><b>Redmi Note 12 pro+ 5g</b></p>
          <div class="shop-item-details">
            <p class="shop-item-price">eth 170</p>
            <button class="btn btn-primary shop-item-button" type="button">
              ADD TO CART
            </button>
          </div>
        </div>
        <div class="col4">
          <img class="shop-item-image" src="watch3.png" alt="" />
          <p class="shop-item-title"><b>Xiomi Digital watch</b></p>
          <div class="shop-item-details">
            <p class="shop-item-price">eth 199</p>
            <button class="btn btn-primary shop-item-button" type="button">
              ADD TO CART
            </button>
          </div>
        </div>
        <div class="col4">
          <img class="shop-item-image" src="watch4.jpeg" alt="" />
          <p class="shop-item-title"><b>Sonata Analoge Watch</b></p>
          <div class="shop-item-details">
            <p class="shop-item-price">eth 180</p>
            <button class="btn btn-primary shop-item-button" type="button">
              ADD TO CART
            </button>
          </div>
        </div>
      </div>
    </div>
    <br />
    <br />
    <!-----------------My Cart---------------->
    <h1 align="center">Your Cart</h1>
    <section class="container content-section">
      <h2
        class="section-header"
        align="center"
        style="color: rgb(238, 137, 154)"
      >
        CART-ITEMS
      </h2>
      <div class="cart-row">
        <span class="cart-item cart-header cart-column">ITEM</span>
        <span class="cart-price cart-header cart-column">PRICE</span>
        <span class="cart-quantity cart-header cart-column">QUANTITY</span>
      </div>
      <div class="cart-items">
        <div class="cart-row">
          <div class="cart-item cart-column">
            <img
              class="cart-item-image"
              src="lotus.jpeg"
              width="100"
              height="100"
            />
            <span class="cart-item-title">Lotus Sunscreen</span>
          </div>
          <span class="cart-price cart-column">eth 17</span>
          <div class="cart-quantity cart-column">
            <input class="cart-quantity-input" type="number" value="1" />
            <button class="btn btn-danger" type="button">REMOVE</button>
          </div>
        </div>
        <div class="cart-row">
          <div class="cart-item cart-column">
            <img
              class="cart-item-image"
              src="Boning Cami Top.jpg"
              width="100"
              height="100"
            />
            <span class="cart-item-title">Boning Cami Top</span>
          </div>
          <span class="cart-price cart-column">eth 17</span>
          <div class="cart-quantity cart-column">
            <input class="cart-quantity-input" type="number" value="1" />
            <button class="btn btn-danger" type="button">REMOVE</button>
          </div>
        </div>
      </div>
      <div class="cart-total">
        <strong style="float: left" class="cart-total-title">Tokens = </strong>
        <span style="float: left; top: auto" class="cart-total-title" id="tkno"
          >0</span
        >
        <strong class="cart-total-title">Total</strong>
        <span class="cart-total-price" id="eth"> 34</span>

        <button class="use-token" onclick="token_click()">Use a Token</button>
        <div class="afterusetokenInput"></div>
      </div>
      <button class="btn btn-primary btn-purchase" onclick="pay()">
        PURCHASE
      </button>
    </section>

    <!-----Footer------>
    <div class="footer">
      <div class="container">
        <div class="row">
          <div class="fcol1">
            <h3>Download our App</h3>
            <p>Download App for Android and ios mobile phone</p>
          </div>
          <div class="fcol2">
            <h3>Useful Links</h3>
            <ul>
              <li>
                <a href="https://www.dealsunny.com/myntra-coupons">Coupon</a>
              </li>
              <li><a href="3blog.html"> Blog Post</a></li>
              <li><a href="6ReturnPolicy.html">Return Policy</a></li>
            </ul>
          </div>
          <div class="fcol3">
            <h3>Follow Us</h3>
            <ul>
              <li>
                <a
                  href="https://www.facebook.com/profile.php?id=100080168403112"
                  >Facebook</a
                >
              </li>
              <li><a href="https://twitter.com/HeyFrau_">Twitter</a></li>
              <li>
                <a href="https://www.instagram.com/heyfrau_/">Instagram</a>
              </li>
              <li><a href="mailto:heyfrau.in@gmail.com">Email</a></li>
            </ul>
          </div>
        </div>
        <hr />
        <h5 class="copyright">Copyright - 2022 All rights reserved</h5>
      </div>
    </div>

    <script>
      contractABI = [
        {
          inputs: [
            {
              internalType: "address",
              name: "_from",
              type: "address",
            },
            {
              internalType: "address payable",
              name: "_to",
              type: "address",
            },
            {
              internalType: "uint256",
              name: "_tokenApplied",
              type: "uint256",
            },
            {
              internalType: "string",
              name: "imgURL",
              type: "string",
            },
            {
              internalType: "string",
              name: "name",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "price",
              type: "uint256",
            },
          ],
          name: "chackOut",
          outputs: [],
          stateMutability: "payable",
          type: "function",
        },
        {
          inputs: [
            {
              internalType: "string",
              name: "str",
              type: "string",
            },
            {
              internalType: "address payable",
              name: "_to",
              type: "address",
            },
          ],
          name: "checkOutUsingVoucher",
          outputs: [],
          stateMutability: "payable",
          type: "function",
        },
        {
          inputs: [
            {
              internalType: "string",
              name: "_code",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "_weeks",
              type: "uint256",
            },
          ],
          name: "createVoucher",
          outputs: [],
          stateMutability: "nonpayable",
          type: "function",
        },
        {
          inputs: [],
          name: "avlTokens",
          outputs: [
            {
              internalType: "uint256",
              name: "",
              type: "uint256",
            },
          ],
          stateMutability: "view",
          type: "function",
        },
        {
          inputs: [
            {
              internalType: "string",
              name: "",
              type: "string",
            },
          ],
          name: "isVoucher",
          outputs: [
            {
              internalType: "bool",
              name: "",
              type: "bool",
            },
          ],
          stateMutability: "view",
          type: "function",
        },
        {
          inputs: [
            {
              internalType: "uint256",
              name: "a",
              type: "uint256",
            },
            {
              internalType: "uint256",
              name: "b",
              type: "uint256",
            },
          ],
          name: "min",
          outputs: [
            {
              internalType: "uint256",
              name: "",
              type: "uint256",
            },
          ],
          stateMutability: "pure",
          type: "function",
        },
        {
          inputs: [
            {
              internalType: "address",
              name: "",
              type: "address",
            },
            {
              internalType: "uint256",
              name: "",
              type: "uint256",
            },
          ],
          name: "user_to_product",
          outputs: [
            {
              internalType: "string",
              name: "imgURL",
              type: "string",
            },
            {
              internalType: "string",
              name: "name",
              type: "string",
            },
            {
              internalType: "uint256",
              name: "id",
              type: "uint256",
            },
          ],
          stateMutability: "view",
          type: "function",
        },
        {
          inputs: [
            {
              internalType: "address",
              name: "",
              type: "address",
            },
          ],
          name: "user_to_token",
          outputs: [
            {
              internalType: "uint256",
              name: "",
              type: "uint256",
            },
          ],
          stateMutability: "view",
          type: "function",
        },
        {
          inputs: [
            {
              internalType: "string",
              name: "",
              type: "string",
            },
          ],
          name: "VoucherExpiry",
          outputs: [
            {
              internalType: "uint256",
              name: "startDate",
              type: "uint256",
            },
            {
              internalType: "uint256",
              name: "endDate",
              type: "uint256",
            },
          ],
          stateMutability: "view",
          type: "function",
        },
      ];
      contractAddress = "0x3E12DEF3240764363b3B8285C7aA990d7cf77Eb4";
      var Contract = NULL;
      async function connectWallet() {
        try {
          web3 = new Web3(window.ethereum); // initialize Web3
          const accounts = await ethereum.request({
            method: "eth_requestAccounts",
          });
          const account = accounts[0];

          console.log(account);
          document.getElementById("cbtn").textContent = "Connected";
          document.getElementById("cbtn").disabled = true;
          const contract = new web3.eth.Contract(contractABI, contractAddress);
          Contract = contract;
          console.log(contract);
          const tokens = await contract.methods.avlTokens().call();
          console.log(Number(tokens));
          const balance = await contract.methods.user_to_token(account).call();
          console.log(Number(balance));
          document.getElementById("tkno").textContent = Number(balance);
        } catch (e) {
          console.log(e);
        }
      }
      async function pay() {
        if (Contract) {
          try {
            web3 = new Web3(window.ethereum); // initialize Web3
            const accounts = await ethereum.request({
              method: "eth_requestAccounts",
            });

            var cartItemContainer =
              document.getElementsByClassName("cart-items")[0];
            var cartRows = cartItemContainer.getElementsByClassName("cart-row");
            var total = 0;
            for (var i = 0; i < cartRows.length; i++) {
              var cartRow = cartRows[i];
              var priceElement =
                cartRow.getElementsByClassName("cart-price")[0];

              var quantityElement = cartRow.getElementsByClassName(
                "cart-quantity-input"
              )[0];
              var price = parseFloat(
                priceElement.innerText.replace("eth", " ")
              );
              var quantity = quantityElement.value;
              total = total + price * quantity;
            }
            total = Math.round(total * 100) / 100;

            console.log(total);
            const weiValue = web3.utils.toWei(33.8, "ether");
            await Contract.methods
              .chackOut(
                accounts[0],
                "0xB60b089d12B4De0BF7E54F34eb3Bf71BaC34b953",
                0,
                "lotus.jpeg",
                "lotus Sunscreen",
                17
              )
              .send({ from: accounts[0], value: weiValue, gas: 48000 });
          } catch (error) {
            console.log(`Error: ${error.message}`);
          }
        } else {
          alert("please connect to wallet");
        }
      }
    </script>
  </body>
</html>
